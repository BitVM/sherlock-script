<!DOCTYPE html>
<html>
	<head>
        <meta charset="utf-8">
        <style type="text/css">
        * {
            background-color : #141414;
            font-family : system-ui;
            font-weight : bold;
            color : #A05C14;
        } body {
            margin : 0px;
        } div {
            border : 0px;
            margin : 0px;
            padding : 0px;
        }
        /* toolbar */
        pre {
            float : left;
            font-size : 33px;
            margin : auto;
            width : 224px;
        } i {
            float : right;
            font-size : 19px;
        } button {
            border : 0px;       
            margin : 0px;
            padding : 0px;
            float : left;
            transform : translate(48px, 0px);
            width : 48px;
            height : 48px;
        } button#magnifier {
            background-image : url('magnifier.png');
        } button#hourglass {
            background-image : url('hourglass.png');
        } code {
            width: 40%;
            float: right;
            white-space: pre-wrap;
            color: #6A352C;
        }
        /* script */
        textarea {
            top : 47px;
            font-size: 15px;
            caret-color : #506464;
            border : none;
            outline : none;
            margin : 0px;
            padding : 0px;
            position : absolute;
            height : calc(100% - 47px);
            width : calc(50% - 4px);
            resize : none;
            overflow : auto;
            scrollbar-color : #3C5050 #141414;
            scrollbar-width : thin;
        }
        textarea#script_0 { left : 4px }
        textarea#script_1 {
            left : calc(4px + 50%);
            color : #141414;
        }
        /* overlay */
        table {
            position : absolute;
            left : 4px;
            top : 48px;
        } s {
            color : #342018;
        } td {
            padding : 0px 12px 0px 0px;
        }
        </style>
        <title>Sherlock script</title>
	</head>
	<body>
		<pre>&nbsp₿&nbsp<span style='color:#3C5050'>Holmes&nbspEditor</span></pre>
		<button id='magnifier'></button>
		<button id='hourglass'></button>
        <!-- <br>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp -->
		<i>Sherlock&nbspscript™&nbsp<span style='color:#3C5050'>arithmetic&nbspexpression</span>&nbsp</i>
        <code id="stdout"></code>
		<div>
			<textarea id='script_0' autofocus spellcheck='false'></textarea>
            <textarea id='script_1' readonly></textarea>
		</div>
        <table id='overlay' style='visibility:hidden'>
            <tr>
                <td>OP_FALSE&nbsp<span style='color:#402C14'>&nbspOP_0</span></td>
                <td>8&nbspbit</td>
                <td>16&nbspbit</td>
                <td>24&nbspbit</td>
                <td>32&nbspbit</td>
                <td style='color:#402C14'>40&nbspbit</td>
                <td style='color:#402C14'>48&nbspbit</td>
                <td style='color:#402C14'>56&nbspbit</td>
            </tr>
            <tr>
                <td style='color:#402C14'>64&nbspbit</td>
                <td style='color:#402C14'>72&nbspbit</td>
                <td style='color:#402C14'>80&nbspbit</td>
                <td style='color:#402C14'>88&nbspbit</td>
                <td style='color:#402C14'>96&nbspbit</td>
                <td style='color:#402C14'>104&nbspbit</td>
                <td style='color:#402C14'>112&nbspbit</td>
                <td style='color:#402C14'>120&nbspbit</td>
            </tr>
            <tr>
                <td style='color:#402C14'>128&nbspbit</td>
                <td style='color:#402C14'>136&nbspbit</td>
                <td style='color:#402C14'>144&nbspbit</td>
                <td style='color:#402C14'>152&nbspbit</td>
                <td style='color:#402C14'>160&nbspbit</td>
                <td style='color:#402C14'>168&nbspbit</td>
                <td style='color:#402C14'>176&nbspbit</td>
                <td style='color:#402C14'>184&nbspbit</td>
            </tr>
            <tr>
                <td style='color:#402C14'>192&nbspbit</td>
                <td style='color:#402C14'>200&nbspbit</td>
                <td style='color:#402C14'>208&nbspbit</td>
                <td style='color:#402C14'>216&nbspbit</td>
                <td style='color:#402C14'>224&nbspbit</td>
                <td style='color:#402C14'>232&nbspbit</td>
                <td style='color:#402C14'>240&nbspbit</td>
                <td style='color:#402C14'>248&nbspbit</td>
            </tr>
            <tr>
                <td style='color:#402C14'>256&nbspbit</td>
                <td style='color:#402C14'>264&nbspbit</td>
                <td style='color:#402C14'>272&nbspbit</td>
                <td style='color:#402C14'>280&nbspbit</td>
                <td style='color:#402C14'>288&nbspbit</td>
                <td style='color:#402C14'>296&nbspbit</td>
                <td style='color:#402C14'>304&nbspbit</td>
                <td style='color:#402C14'>312&nbspbit</td>
            </tr>
            <tr>
                <td style='color:#402C14'>320&nbspbit</td>
                <td style='color:#402C14'>328&nbspbit</td>
                <td style='color:#402C14'>336&nbspbit</td>
                <td style='color:#402C14'>344&nbspbit</td>
                <td style='color:#402C14'>352&nbspbit</td>
                <td style='color:#402C14'>360&nbspbit</td>
                <td style='color:#402C14'>368&nbspbit</td>
                <td style='color:#402C14'>376&nbspbit</td>
            </tr>
            <tr>
                <td style='color:#402C14'>384&nbspbit</td>
                <td style='color:#402C14'>392&nbspbit</td>
                <td style='color:#402C14'>400&nbspbit</td>
                <td style='color:#402C14'>408&nbspbit</td>
                <td style='color:#402C14'>416&nbspbit</td>
                <td style='color:#402C14'>424&nbspbit</td>
                <td style='color:#402C14'>432&nbspbit</td>
                <td style='color:#402C14'>440&nbspbit</td>
            </tr>
            <tr>
                <td style='color:#402C14'>448&nbspbit</td>
                <td style='color:#402C14'>456&nbspbit</td>
                <td style='color:#402C14'>464&nbspbit</td>
                <td style='color:#402C14'>472&nbspbit</td>
                <td style='color:#402C14'>480&nbspbit</td>
                <td style='color:#402C14'>488&nbspbit</td>
                <td style='color:#402C14'>496&nbspbit</td>
                <td style='color:#402C14'>504&nbspbit</td>
            </tr>
            <tr>
                <td style='color:#402C14'>512&nbspbit</td>
                <td style='color:#402C14'>520&nbspbit</td>
                <td style='color:#402C14'>528&nbspbit</td>
                <td style='color:#402C14'>536&nbspbit</td>
                <td style='color:#402C14'>544&nbspbit</td>
                <td style='color:#402C14'>552&nbspbit</td>
                <td style='color:#402C14'>560&nbspbit</td>
                <td style='color:#402C14'>568&nbspbit</td>
            </tr>
            <tr>
                <td style='color:#402C14'>576&nbspbit</td>
                <td style='color:#402C14'>584&nbspbit</td>
                <td style='color:#402C14'>592&nbspbit</td>
                <td style='color:#402C14'>600&nbspbit</td>
                <td style='color:#402C14'>OP_PUSHDATA1</td>
                <td style='color:#402C14'>OP_PUSHDATA2</td>
                <td style='color:#402C14'>OP_PUSHDATA4</td>
                <td>OP_1NEGATE</td>
            </tr>
            <tr>
                <td style='color:#402C14'>OP_RESERVED</td>
                <td>OP_TRUE&nbsp<span style='color:#402C14'>&nbspOP_1</span></td>
                <td>OP_2</td>
                <td>OP_3</td>
                <td>OP_4</td>
                <td>OP_5</td>
                <td>OP_6</td>
                <td>OP_7</td>
            </tr>
            <tr>
                <td>OP_8</td>
                <td>OP_9</td>
                <td>OP_10</td>
                <td>OP_11</td>
                <td>OP_12</td>
                <td>OP_13</td>
                <td>OP_14</td>
                <td>OP_15</td>
            </tr>
            <tr>
                <td>OP_16</td>
                <td style='color:#402C14'>OP_NOP</td>
                <td style='color:#402C14'>OP_VER</td>
                <td>OP_IF</td>
                <td>OP_NOTIF</td>
                <td style='color:#402C14'>OP_VERIF</td>
                <td style='color:#402C14'>OP_VERNOTIF</td>
                <td>OP_ELSE</td>
            </tr>
            <tr>
                <td>OP_ENDIF</td>
                <td style='color:#402C14'>OP_VERIFY</td>
                <td style='color:#402C14'>OP_RETURN</td>
                <td>OP_TOALTSTACK</td>
                <td>OP_FROMALTSTACK</td>
                <td>OP_2DROP</td>
                <td>OP_2DUP</td>
                <td>OP_3DUP</td>
            </tr>
            <tr>
                <td>OP_2OVER</td>
                <td>OP_2ROT</td>
                <td>OP_2SWAP</td>
                <td style='color:#402C14'>OP_IFDUP</td>
                <td style='color:#402C14'>OP_DEPTH</td>
                <td>OP_DROP</td>
                <td>OP_DUP</td>
                <td>OP_NIP</td>
            </tr>
            <tr>
                <td>OP_OVER</td>
                <td>OP_PICK</td>
                <td>OP_ROLL</td>
                <td>OP_ROT</td>
                <td>OP_SWAP</td>
                <td>OP_TUCK</td>
                <td><s>OP_CAT</s></td>
                <td><s>OP_SUBSTR</s></td>
            </tr>
            <tr>
                <td><s>OP_LEFT</s></td>
                <td><s>OP_RIGHT</s></td>
                <td style='color:#402C14'>OP_SIZE</td>
                <td><s>OP_INVERT</s></td>
                <td><s>OP_AND</s></td>
                <td><s>OP_OR</s></td>
                <td><s>OP_XOR</s></td>
                <td>OP_EQUAL</td>
            </tr>
            <tr>
                <td style='color:#402C14'>OP_EQUALVERIFY</td>
                <td style='color:#402C14'>OP_RESERVED1</td>
                <td style='color:#402C14'>OP_RESERVED2</td>
                <td>OP_1ADD</td>
                <td>OP_1SUB</td>
                <td><s>OP_2MUL</s></td>
                <td><s>OP_2DIV</s></td>
                <td>OP_NEGATE</td>
            </tr>
            <tr>
                <td style='color:#402C14'>OP_ABS</td>
                <td>OP_NOT</td>
                <td>OP_0NOTEQUAL</td>
                <td>OP_ADD</td>
                <td>OP_SUB</td>
                <td><s>OP_MUL</s></td>
                <td><s>OP_DIV</s></td>
                <td><s>OP_MOD</s></td>
            </tr>
            <tr>
                <td><s>OP_LSHIFT</s></td>
                <td><s>OP_RSHIFT</s></td>
                <td>OP_BOOLAND</td>
                <td>OP_BOOLOR</td>
                <td>OP_NUMEQUAL</td>
                <td style='color:#402C14'>OP_NUMEQUALVERIFY</td>
                <td>OP_NUMNOTEQUAL</td>
                <td>OP_LESSTHAN</td>
            </tr>
            <tr>
                <td>OP_GREATERTHAN</td>
                <td>OP_LESSTHANOREQUAL</td>
                <td>OP_GREATERTHANOREQUAL</td>
                <td style='color:#402C14'>OP_MIN</td> 
                <td style='color:#402C14'>OP_MAX</td>
                <td style='color:#402C14'>OP_WITHIN</td>
                <td style='color:#402C14'>OP_RIPEMD160</td>
                <td style='color:#402C14'>OP_SHA1</td>
            </tr>
            <tr>
                <td style='color:#402C14'>OP_SHA256</td>
                <td style='color:#402C14'>OP_HASH160</td>
                <td style='color:#402C14'>OP_HASH256</td>
                <td style='color:#402C14'>OP_CODESEPARATOR</td> 
                <td style='color:#402C14'>OP_CHECKSIG</td>
                <td style='color:#402C14'>OP_CHECKSIGVERIFY</td>
                <td style='color:#402C14'>OP_CHECKMULTISIG</td>
                <td style='color:#402C14'>OP_CHECKMULTISIGVERIFY</td> 
            </tr>
            <tr>
                <td style='color:#402C14'>OP_NOP1</td>
                <td style='color:#402C14'>OP_CHECKLOCKTIMEVERIFY</td>
                <td style='color:#402C14'>OP_CHECKSEQUENCEVERIFY</td>
                <td style='color:#402C14'>OP_NOP4</td>
                <td style='color:#402C14'>OP_NOP5</td>
                <td style='color:#402C14'>OP_NOP6</td>
                <td style='color:#402C14'>OP_NOP7</td>
                <td style='color:#402C14'>OP_NOP8</td>
            </tr>
            <tr>
                <td style='color:#402C14'>OP_NOP9</td>
                <td style='color:#402C14'>OP_NOP10</td>
                <td style='color:#402C14'>OP_CHECKSIGADD</td>
                <td style='color:#2C2517'>0xBB</td>
                <td style='color:#2C2517'>0xBC</td>
                <td style='color:#2C2517'>0xBD</td>
                <td style='color:#2C2517'>0xBE</td>
                <td style='color:#2C2517'>0xBF</td>
            </tr>
            <tr>
                <td style='color:#2C2517'>0xC0</td>
                <td style='color:#2C2517'>0xC1</td>
                <td style='color:#2C2517'>0xC2</td>
                <td style='color:#2C2517'>0xC3</td>
                <td style='color:#2C2517'>0xC4</td>
                <td style='color:#2C2517'>0xC5</td>
                <td style='color:#2C2517'>0xC6</td>
                <td style='color:#2C2517'>0xC7</td>
            </tr>
            <tr>
                <td style='color:#2C2517'>0xC8</td>
                <td style='color:#2C2517'>0xC9</td>
                <td style='color:#2C2517'>0xCA</td>
                <td style='color:#2C2517'>0xCB</td>
                <td style='color:#2C2517'>0xCC</td>
                <td style='color:#2C2517'>0xCD</td>
                <td style='color:#2C2517'>0xCE</td>
                <td style='color:#2C2517'>0xCF</td>
            </tr>
            <tr>
                <td style='color:#2C2517'>0xD0</td>
                <td style='color:#2C2517'>0xD1</td>
                <td style='color:#2C2517'>0xD2</td>
                <td style='color:#2C2517'>0xD3</td>
                <td style='color:#2C2517'>0xD4</td>
                <td style='color:#2C2517'>0xD5</td>
                <td style='color:#2C2517'>0xD6</td>
                <td style='color:#2C2517'>0xD7</td>
            </tr>
            <tr>
                <td style='color:#2C2517'>0xD8</td>
                <td style='color:#2C2517'>0xD9</td>
                <td style='color:#2C2517'>0xDA</td>
                <td style='color:#2C2517'>0xDB</td>
                <td style='color:#2C2517'>0xDC</td>
                <td style='color:#2C2517'>0xDD</td>
                <td style='color:#2C2517'>0xDE</td>
                <td style='color:#2C2517'>0xDF</td>
            </tr>
            <tr>
                <td style='color:#2C2517'>0xE0</td>
                <td style='color:#2C2517'>0xE1</td>
                <td style='color:#2C2517'>0xE2</td>
                <td style='color:#2C2517'>0xE3</td>
                <td style='color:#2C2517'>0xE4</td>
                <td style='color:#2C2517'>0xE5</td>
                <td style='color:#2C2517'>0xE6</td>
                <td style='color:#2C2517'>0xE7</td>
            </tr>
            <tr>
                <td style='color:#2C2517'>0xE8</td>
                <td style='color:#2C2517'>0xE9</td>
                <td style='color:#2C2517'>0xEA</td>
                <td style='color:#2C2517'>0xEB</td>
                <td style='color:#2C2517'>0xEC</td>
                <td style='color:#2C2517'>0xED</td>
                <td style='color:#2C2517'>0xEE</td>
                <td style='color:#2C2517'>0xEF</td>
            </tr>
            <tr>
                <td style='color:#2C2517'>0xF0</td>
                <td style='color:#2C2517'>0xF1</td>
                <td style='color:#2C2517'>0xF2</td>
                <td style='color:#2C2517'>0xF3</td>
                <td style='color:#2C2517'>0xF4</td>
                <td style='color:#2C2517'>0xF5</td>
                <td style='color:#2C2517'>0xF6</td>
                <td style='color:#2C2517'>0xF7</td>
            </tr>
            <tr>
                <td style='color:#2C2517'>0xF8</td>
                <td style='color:#2C2517'>0xF9</td>
                <td style='color:#2C2517'>0xFA</td>
                <td style='color:#2C2517'>0xFB</td>
                <td style='color:#2C2517'>0xFC</td>
                <td style='color:#2C2517'>0xFD</td>
                <td style='color:#2C2517'>0xFE</td>
                <td style='color:#2C2517'>0xFF</td>
            </tr>
        </table>
        <script>

        // Parse opcode
        const TO_OPCODE = {
         'OP_FALSE':0, 'OP_0':0, 'OP_PUSHDATA1':76, 'OP_PUSHDATA2':77, 'OP_PUSHDATA4':78, 'OP_1NEGATE':79, 'OP_RESERVED':80, 'OP_TRUE':81, 'OP_1':81,
         'OP_2':82, 'OP_3':83, 'OP_4':84, 'OP_5':85, 'OP_6':86, 'OP_7':87, 'OP_8':88, 'OP_9':89, 'OP_10':90, 'OP_11':91, 'OP_12':92, 'OP_13':93, 'OP_14':94,
         'OP_15':95, 'OP_16':96, 'OP_NOP':97, 'OP_VER':98, 'OP_IF':99, 'OP_NOTIF':100, 'OP_VERIF':101, 'OP_VERNOTIF':102, 'OP_ELSE':103, 'OP_ENDIF':104,
         'OP_VERIFY':105, 'OP_RETURN':106, 'OP_TOALTSTACK':107, 'OP_FROMALTSTACK':108, 'OP_2DROP':109, 'OP_2DUP':110, 'OP_3DUP':111, 'OP_2OVER':112,
         'OP_2ROT':113, 'OP_2SWAP':114, 'OP_IFDUP':115, 'OP_DEPTH':116, 'OP_DROP':117, 'OP_DUP':118, 'OP_NIP':119, 'OP_OVER':120, 'OP_PICK':121,
         'OP_ROLL':122, 'OP_ROT':123, 'OP_SWAP':124, 'OP_TUCK':125, 'OP_CAT':126, 'OP_SUBSTR':127, 'OP_LEFT':128, 'OP_RIGHT':129, 'OP_SIZE':130,
         'OP_INVERT':131, 'OP_AND':132, 'OP_OR':133, 'OP_XOR':134, 'OP_EQUAL':135, 'OP_EQUALVERIFY':136, 'OP_RESERVED1':137, 'OP_RESERVED2':138,
         'OP_1ADD':139, 'OP_1SUB':140, 'OP_2MUL':141, 'OP_2DIV':142, 'OP_NEGATE':143, 'OP_ABS':144, 'OP_NOT':145, 'OP_0NOTEQUAL':146, 'OP_ADD':147,
         'OP_SUB':148, 'OP_MUL':149, 'OP_DIV':150, 'OP_MOD':151, 'OP_LSHIFT':152, 'OP_RSHIFT':153, 'OP_BOOLAND':154, 'OP_BOOLOR':155, 'OP_NUMEQUAL':156,
         'OP_NUMEQUALVERIFY':157, 'OP_NUMNOTEQUAL':158, 'OP_LESSTHAN':159, 'OP_GREATERTHAN':160, 'OP_LESSTHANOREQUAL':161, 'OP_GREATERTHANOREQUAL':162,
         'OP_MIN':163, 'OP_MAX':164, 'OP_WITHIN':165, 'OP_RIPEMD160':166, 'OP_SHA1':167, 'OP_SHA256':168, 'OP_HASH160':169, 'OP_HASH256':170,
         'OP_CODESEPARATOR':171, 'OP_CHECKSIG':172, 'OP_CHECKSIGVERIFY':173, 'OP_CHECKMULTISIG':174, 'OP_CHECKMULTISIGVERIFY':175, 'OP_NOP1':176,
         'OP_CHECKLOCKTIMEVERIFY':177, 'OP_NOP2':177, 'OP_CHECKSEQUENCEVERIFY':178, 'OP_NOP3':178, 'OP_NOP4':179, 'OP_NOP5':180, 'OP_NOP6':181,
         'OP_NOP7':182, 'OP_NOP8':183, 'OP_NOP9':184, 'OP_NOP10':185, 'OP_CHECKSIGADD':186, 'OP_PUBKEYHASH':253, 'OP_PUBKEY':254, 'OP_INVALIDOPCODE':255
        };

        // Make opcode readable
        const TO_STRING = {
         0:'OP_FALSE', 0:'OP_0', 76:'OP_PUSHDATA1', 77:'OP_PUSHDATA2', 78:'OP_PUSHDATA4', 79:'OP_1NEGATE', 80:'OP_RESERVED', 81:'OP_TRUE', 81:'OP_1',
         82:'OP_2', 83:'OP_3', 84:'OP_4', 85:'OP_5', 86:'OP_6', 87:'OP_7', 88:'OP_8', 89:'OP_9', 90:'OP_10', 91:'OP_11', 92:'OP_12', 93:'OP_13', 94:'OP_14',
         95:'OP_15', 96:'OP_16', 97:'OP_NOP', 98:'OP_VER', 99:'OP_IF', 100:'OP_NOTIF', 101:'OP_VERIF', 102:'OP_VERNOTIF', 103:'OP_ELSE', 104:'OP_ENDIF',
         105:'OP_VERIFY', 106:'OP_RETURN', 107:'OP_TOALTSTACK', 108:'OP_FROMALTSTACK', 109:'OP_2DROP', 110:'OP_2DUP', 111:'OP_3DUP', 112:'OP_2OVER',
         113:'OP_2ROT', 114:'OP_2SWAP', 115:'OP_IFDUP', 116:'OP_DEPTH', 117:'OP_DROP', 118:'OP_DUP', 119:'OP_NIP', 120:'OP_OVER', 121:'OP_PICK',
         122:'OP_ROLL', 123:'OP_ROT', 124:'OP_SWAP', 125:'OP_TUCK', 126:'OP_CAT', 127:'OP_SUBSTR', 128:'OP_LEFT', 129:'OP_RIGHT', 130:'OP_SIZE',
         131:'OP_INVERT', 132:'OP_AND', 133:'OP_OR', 134:'OP_XOR', 135:'OP_EQUAL', 136:'OP_EQUALVERIFY', 137:'OP_RESERVED1', 138:'OP_RESERVED2',
         139:'OP_1ADD', 140:'OP_1SUB', 141:'OP_2MUL', 142:'OP_2DIV', 143:'OP_NEGATE', 144:'OP_ABS', 145:'OP_NOT', 146:'OP_0NOTEQUAL', 147:'OP_ADD',
         148:'OP_SUB', 149:'OP_MUL', 150:'OP_DIV', 151:'OP_MOD', 152:'OP_LSHIFT', 153:'OP_RSHIFT', 154:'OP_BOOLAND', 155:'OP_BOOLOR', 156:'OP_NUMEQUAL',
         157:'OP_NUMEQUALVERIFY', 158:'OP_NUMNOTEQUAL', 159:'OP_LESSTHAN', 160:'OP_GREATERTHAN', 161:'OP_LESSTHANOREQUAL', 162:'OP_GREATERTHANOREQUAL',
         163:'OP_MIN', 164:'OP_MAX', 165:'OP_WITHIN', 166:'OP_RIPEMD160', 167:'OP_SHA1', 168:'OP_SHA256', 169:'OP_HASH160', 170:'OP_HASH256',
         171:'OP_CODESEPARATOR', 172:'OP_CHECKSIG', 173:'OP_CHECKSIGVERIFY', 174:'OP_CHECKMULTISIG', 175:'OP_CHECKMULTISIGVERIFY', 176:'OP_NOP1',
         177:'OP_CHECKLOCKTIMEVERIFY', 177:'OP_NOP2', 178:'OP_CHECKSEQUENCEVERIFY', 178:'OP_NOP3', 179:'OP_NOP4', 180:'OP_NOP5', 181:'OP_NOP6',
         182:'OP_NOP7', 183:'OP_NOP8', 184:'OP_NOP9', 185:'OP_NOP10', 186:'OP_CHECKSIGADD', 253:'OP_PUBKEYHASH', 254:'OP_PUBKEY', 255:'OP_INVALIDOPCODE'
        };

        // Make script readable
        function to_string (bytes) {
            let text = [ ]
            let index = 0;
            while (index < bytes.length) {
                const byte = bytes [index ++];
                const opcode = TO_STRING [byte];
                if (opcode !== undefined) {
                    text [text.length] = opcode
                    continue;
                }
                let number = 0;
                switch(byte) {
                    case 1:
                        number <<= 8; number |= bytes [index ++];
                        text [text.length] = number.toString(10);
                        continue;
                    case 2:
                        number <<= 8; number |= bytes [index ++];
                        number <<= 8; number |= bytes [index ++];
                        text [text.length] = number.toString(10);
                        continue;
                    case 3:
                        number <<= 8; number |= bytes [index ++];
                        number <<= 8; number |= bytes [index ++];
                        number <<= 8; number |= bytes [index ++];
                        text [text.length] = number.toString(10);
                        continue;
                    case 4:
                        number <<= 8; number |= bytes [index ++];
                        number <<= 8; number |= bytes [index ++];
                        number <<= 8; number |= bytes [index ++];
                        number <<= 8; number |= bytes [index ++];
                        text [text.length] = number.toString(10);
                        continue;
                    default:
                        throw byte;
                }
            }
            return text.join('\n')
        }

        // Parse script
        function to_opcode (string) {
            let script = [];
            for (const item of string.split(/[\s,]+/)) {
                if (item.length === 0) continue;
                let opcode = TO_OPCODE [item];
                if (opcode !== undefined) {
                    script [script.length] = opcode;
                    continue
                }
                let number = parseInt(item);
                if (-1 <= number && number <= 16) {
                    script [script.length] = number == -1 ? TO_OPCODE ['OP_1NEGATE'] : TO_OPCODE ['OP_' + number];
                    continue
                }
                if (Math.abs(number) < 2 ** 8) {
                    script [script.length] = 1;
                    script [script.length] = number;
                    continue
                }
                if (Math.abs(number) < 2 ** 16) {
                    script [script.length] = 2;
                    script [script.length] = number & 0xFF;
                    script [script.length] = number >> 8;
                    continue
                }
                if (Math.abs(number) < 2 ** 24) {
                    script [script.length] = 3;
                    script [script.length] = number & 0xFF;
                    script [script.length] = number >> 8 & 0xFF;
                    script [script.length] = number >> 16;
                    continue
                }
                if (Math.abs(number) < 2 ** 32) {
                    script [script.length] = 4;
                    script [script.length] = number & 0xFF;
                    script [script.length] = number >> 8 & 0xFF;
                    script [script.length] = number >> 16 & 0xFF;
                    script [script.length] = number >> 24;
                    continue
                }
            }
            return script
        }

        // Play sand animation
        function flip_hourglass ( ) {
            if (hourglass.interval !== undefined) return;
            if (hourglass.index === undefined) hourglass.index = 6;
            hourglass.interval = setInterval(function ( ) {
                ++ hourglass.index;
                const dark = 0x14;
                const red = 0xA0;
                const green = 0x5C;
                const blue = 0x14;
                const blend = Math.abs(5 - hourglass.index) / 6;
                const inv = 1.0 - blend;
                script_1.style.color = '#'+(Math.floor(blend * red + inv * dark) << 16 | Math.floor(blend * green + inv * dark) << 8 | Math.floor(blend * blue + inv * dark)).toString(16);
                hourglass.style.backgroundPosition = hourglass.index % 3 * -48 + "px " + Math.floor(hourglass.index / 3) % 4 * -48 + "px";
                if (hourglass.index == 12) {
                    clearInterval(hourglass.interval);
                    hourglass.interval = undefined;
                    hourglass.index = 0;
                }
            }, 120);
        }

        (async function ( ) {

            // Load WASM
            const sherlock_wasm = await fetch ('sherlock.wasm');
            const array_buffer = await sherlock_wasm.arrayBuffer ( );
            const web_assembly = await WebAssembly.instantiate (array_buffer);
            const buffer = web_assembly.instance.exports.memory.buffer;
            const compile = web_assembly.instance.exports.compile;

            // // Load example code
            // script_0.value = to_string ([81, 82, 147]);
            // script_1.value = to_string ([83]);

            // Load script from cookies
            script_0.value = localStorage.getItem ('script_0');
            script_1.value = localStorage.getItem ('script_1');
            stdout.textContent = localStorage.getItem ('stdout');

            // Peek sand animation
            flip_hourglass ( );

            stdout.offset = 0;
            stdout.length = 0;

            var __stdout__ = [];

            // Press TAB to show the opcode legend
            document.addEventListener ('keydown', function (_) { if (_.code === 'Tab') overlay.style.visibility = 'visible' });
            document.addEventListener ('keyup', function (_) { if (_.code === 'Tab') overlay.style.visibility = 'hidden' })
            document.addEventListener ('wheel', function (_) {
                stdout.offset = Math.max (Math.min (stdout.offset + Math.sign (_.deltaY), stdout.length - 2), 0);
                stdout.textContent = __stdout__.slice (stdout.offset, stdout.offset + 2).join ('\n');
            })

            // Recompile on `textarea` changes
            script_0.addEventListener ('keyup', function(_) {
                switch (_.code) {
                case 'Escape':
                case 'Enter':
                case 'Space':
                case 'Tab':
                case 'ArrowUp':
                case 'ArrowDown':
                case 'ArrowRight':
                case 'ArrowLeft':
                case 'ShiftLeft':
                case 'ControlLeft':
                case 'AltLeft':
                case 'MetaLeft':
                case 'ControlRight':
                case 'AltRight':
                case 'PrintScreen':
                case 'Insert':
                case 'NumpadEnter':
                case 'NumLock':
                case 'ShiftRight':
                case 'F2':
                case 'F4':
                case 'F9':
                    return;
                default:
                    setTimeout (function ( ) {
                        let input = to_opcode (script_0.value);
                        if (input.length == 0)
                        {
                            stdout.offset = 0;
                            stdout.length = 0;
                            stdout.textContent = '';
                        }
                        else
                        {
                            let array = new Uint8Array (buffer, 0, input.length);
                            array.set (input);
                            let message = new Uint8Array (buffer, input.length, 768+1024);
                            message.fill(0, 0, 768+1024);
                            let length = compile (array.byteOffset, input.length, message.byteOffset);
                            let output = array.slice (0, Math.min (Array.from (array).length, length));
                            script_1.value = to_string (output);
                            let bytes = Array.from (message);
                            __stdout__ = new TextDecoder ( ).decode (new Uint8Array (bytes.slice (0, bytes.indexOf (0)))).split ('\n').filter (_ => _.length);
                            stdout.offset = 0;
                            stdout.length = __stdout__.length;
                            stdout.textContent = __stdout__.slice(0, __stdout__.length).join('\n');
                            // Save script as cookie
                            localStorage.setItem ('script_0', script_0.value);
                            localStorage.setItem ('script_1', script_1.value);
                            localStorage.setItem ('stdout', stdout.textContent);
                        }
                    }, 720);
                    return flip_hourglass ( );
                }
            });
        }) ( );
        </script>
	</body>
</html>